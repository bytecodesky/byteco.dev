---
import { statusData } from '../data/status';
import { X, ChevronRight, Activity } from 'lucide-astro';

// Import icons dynamically based on the icon name
const iconMap: Record<string, any> = {
  Mail: await import('lucide-astro').then(m => m.Mail),
  Github: await import('lucide-astro').then(m => m.Github),
  Twitter: await import('lucide-astro').then(m => m.Twitter),
  Linkedin: await import('lucide-astro').then(m => m.Linkedin),
  X: await import('lucide-astro').then(m => m.Twitter), // Using Twitter icon for X
};

const { currentStatus, quickLinks } = statusData;
---

<!-- Overlay -->
<div
  id="status-overlay"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] hidden transition-opacity duration-300"
>
</div>

<!-- Drawer Panel -->
<div
  id="status-panel"
  class="fixed top-0 right-0 h-screen w-full md:w-[400px] z-[70] glass-card rounded-none border-l border-[rgba(var(--color-glass-border),0.08)] transform translate-x-full transition-transform duration-300 ease-out"
>
  <div class="h-full flex flex-col p-8">
    <!-- Header -->
    <div class="flex items-start justify-between mb-8">
      <h2 class="text-2xl font-bold text-[rgb(var(--color-text-primary))]">
        Status
      </h2>
      <button
        id="close-status-panel"
        class="text-[rgb(var(--color-text-tertiary))] hover:text-[rgb(var(--color-text-primary))] transition-colors p-2 rounded-lg hover:bg-[rgba(var(--color-glass-bg),0.05)]"
        aria-label="Close status panel"
      >
        <X size={24} />
      </button>
    </div>

    <!-- Current Status -->
    <div class="mb-8 p-6 glass-card">
      <div class="flex items-start gap-4">
        <Activity size={32} class="text-[rgb(var(--color-text-primary))]" />
        <div>
          <h3 class="text-sm font-medium text-[rgb(var(--color-text-tertiary))] mb-2">
            Current Status
          </h3>
          <p class="text-lg text-[rgb(var(--color-text-primary))] leading-relaxed">
            {currentStatus}
          </p>
        </div>
      </div>
    </div>

    <!-- Quick Links -->
    <div>
      <h3 class="text-sm font-medium text-[rgb(var(--color-text-tertiary))] mb-4">
        Quick Links
      </h3>
      <div class="space-y-3">
        {quickLinks.map((link) => {
          const Icon = iconMap[link.icon];
          return (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center gap-4 p-4 glass-card-hover group"
            >
              <Icon size={20} />
              <span class="text-[rgb(var(--color-text-primary))] font-medium group-hover:text-[rgb(var(--color-text-secondary))] transition-colors">
                {link.label}
              </span>
              <ChevronRight size={20} class="ml-auto text-[rgb(var(--color-text-tertiary))] group-hover:text-[rgb(var(--color-text-primary))] transition-colors" />
            </a>
          );
        })}
      </div>
    </div>

    <!-- Footer info -->
    <div class="mt-auto pt-6 border-t border-[rgba(var(--color-glass-border),0.08)]">
      <p class="text-xs text-[rgb(var(--color-text-tertiary))] text-center">
        You can edit this status in <code class="text-[rgb(var(--color-text-primary))]">src/data/status.ts</code>
      </p>
    </div>
  </div>
</div>

<script>
  const closeButton = document.getElementById('close-status-panel');
  const overlay = document.getElementById('status-overlay');
  const panel = document.getElementById('status-panel');

  function closePanel() {
    if (panel && overlay) {
      panel.classList.remove('translate-x-0');
      panel.classList.add('translate-x-full');
      overlay.classList.add('hidden');
    }
  }

  if (closeButton) {
    closeButton.addEventListener('click', closePanel);
  }

  if (overlay) {
    overlay.addEventListener('click', closePanel);
  }

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closePanel();
    }
  });
</script>
