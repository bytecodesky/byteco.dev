---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';
import NoteCard from '../../components/NoteCard.astro';
import { getAllTags, getPostsByTag, getNotesByTag } from '../../lib/content';

export async function getStaticPaths() {
  const tagCounts = await getAllTags();
  return Array.from(tagCounts.keys()).map((tag) => ({
    params: { tag },
  }));
}

const { tag } = Astro.params;

const posts = await getPostsByTag(tag);
const notes = await getNotesByTag(tag);
const totalCount = posts.length + notes.length;
---

<BaseLayout
  title={`#${tag} - byteco.dev`}
  description={`Posts and notes tagged with ${tag}`}
>
  <div class="container mx-auto px-4 py-12">
    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4 text-[rgb(var(--color-text-primary))]">
        <span class="text-[rgb(var(--color-accent))]">#{tag}</span>
      </h1>
      <p class="text-lg text-[rgb(var(--color-text-secondary))]">
        {totalCount} {totalCount === 1 ? 'item' : 'items'} tagged with {tag}
      </p>
    </header>

    {posts.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 text-[rgb(var(--color-text-primary))]">
          Blog Posts ({posts.length})
        </h2>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {posts.map((post) => (
            <BlogPostCard post={post} />
          ))}
        </div>
      </section>
    )}

    {notes.length > 0 && (
      <section>
        <h2 class="text-2xl font-bold mb-6 text-[rgb(var(--color-text-primary))]">
          Notes ({notes.length})
        </h2>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {notes.map((note) => (
            <NoteCard note={note} />
          ))}
        </div>
      </section>
    )}

    {totalCount === 0 && (
      <p class="text-[rgb(var(--color-text-tertiary))]">No content found with this tag.</p>
    )}
  </div>
</BaseLayout>
