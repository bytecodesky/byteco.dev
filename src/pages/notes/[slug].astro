---
import { type CollectionEntry, getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import TableOfContents from '../../components/TableOfContents.astro';
import TagList from '../../components/TagList.astro';
import { formatDate } from '../../utils/helpers';
import { ArrowLeft, BookOpen } from 'lucide-astro';

export async function getStaticPaths() {
  const notes = await getCollection('notes');
  return notes.map((note) => ({
    params: { slug: note.slug },
    props: { note },
  }));
}

interface Props {
  note: CollectionEntry<'notes'>;
}

const { note } = Astro.props;
const { Content, headings } = await note.render();
const { title, date, tags } = note.data;
---

<BaseLayout
  title={`${title} - byteco.dev`}
  description={`Note: ${title}`}
>
  <article class="container mx-auto px-8 py-16 max-w-5xl">
    <header class="mb-12">
      <a
        href="/notes"
        class="inline-flex items-center gap-2 text-[rgb(var(--color-text-tertiary))] hover:text-[rgb(var(--color-text-primary))] transition-colors mb-8"
      >
        <ArrowLeft size={20} />
        Back to Notes
      </a>
      
      <div class="mb-6">
        <h1 class="text-5xl font-bold text-[rgb(var(--color-text-primary))] leading-tight">
          {title}
        </h1>
      </div>
      <time class="text-sm text-[rgb(var(--color-text-tertiary))]" datetime={date.toISOString()}>
        {formatDate(date)}
      </time>
      {tags.length > 0 && (
        <div class="mt-6">
          <TagList tags={tags} />
        </div>
      )}
    </header>

    <div class="grid md:grid-cols-[1fr_280px] gap-12">
      <div class="glass-card p-8 md:p-12">
        <div class="prose">
          <Content />
        </div>
      </div>
      {headings.length > 0 && (
        <aside class="hidden md:block">
          <div class="sticky top-8">
            <TableOfContents headings={headings} />
          </div>
        </aside>
      )}
    </div>
  </article>
</BaseLayout>
